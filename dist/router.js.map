{"version":3,"sources":["router.js"],"names":["Router","options","classFactory","baseUrl","loader","nav","state","formerPages","page","stateBlock","transition","loading","$window","window","$body","deviceType","any","addClass","currentRequest","cacheProvider","homeHasClass","ajaxEnabled","pageClass","objectTypeAttr","ajaxLinkTypeAttr","noAjaxLinkClass","navLinkClass","activeClass","pageBlockClass","lazyloadEnabled","lazyloadSrcAttr","lazyloadClass","lazyloadSrcSetAttr","$ajaxContainer","minLoadDuration","preLoadPageDelay","useCache","postLoad","data","preLoad","prePushState","onDestroy","preBoot","$cont","context","isHome","extend","destroy","removeEventListener","onPopState","bind","onDestroyBinded","initEvents","addEventListener","event","loadPage","boot","loadBeginDate","Date","preBootBinded","nodeType","attr","getPageInstance","update","onLinkClick","e","linkClassName","currentTarget","className","linkHref","href","indexOf","preventDefault","previousType","type","previousName","name","previousHref","location","prePushStateBinded","history","pushState","title","readyState","abort","show","preLoadBinded","setTimeout","doPageLoad","exists","debug","_onDataLoaded","fetch","ajax","url","dataType","headers","cache","success","save","$data","$response","parseHTML","trim","hasClass","find","append","push","updatePageTitle","postLoadBinded","ga","pathname","document","length","metaTitle","pushFirstState"],"mappings":"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","file":"router.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file router.js\n * @author Ambroise Maupate\n */\nimport $ from \"jquery\";\nimport isMobile from \"isMobile\";\nimport log from \"loglevel\";\nimport {Utils} from \"utils/utils\";\nimport {State} from \"state\";\nimport {CacheProvider} from \"cache-provider\";\nimport {Home} from \"pages/home\";\n\nexport class Router {\n    /**\n     * Create a new Router.\n     *\n     * Default options list:\n     *\n     * * `homeHasClass`: false,\n     * * `ajaxEnabled`: true,\n     * * `pageClass`: \"page-content\", (Without point!)\n     * * `objectTypeAttr`: \"data-node-type\",\n     * * `ajaxLinkTypeAttr` : \"data-node-type\"\n     * * `noAjaxLinkClass`: \"no-ajax-link\",\n     * * `navLinkClass`: \"nav-link\",\n     * * `activeClass`: \"active\",\n     * * `useCache`: true,\n     * * `pageBlockClass`: \".page-block\", (With point!)\n     * * `$ajaxContainer`: $(\"#ajax-container\"),\n     * * `lazyloadEnabled`: false,\n     * * `lazyloadSrcAttr`: 'data-src',\n     * * `lazyloadClass`: 'lazyload',\n     * * `lazyloadSrcSetAttr`: 'data-src-set',\n     * * `minLoadDuration`: 0,\n     * * `postLoad`: (state, data) => {},\n     * * `preLoad`: (state) => {},\n     * * `preLoadPageDelay`: 0\n     * * `prePushState`: (state) => {},\n     * * `onDestroy`: () => {},\n     * * `preBoot`: ($cont, context, isHome) => {},\n     *\n     *\n     * @param {Object} options\n     * @param {ClassFactory} classFactory\n     * @param {String} baseUrl\n     * @param {GraphicLoader} loader\n     * @param {AbstractNav} nav\n     */\n    constructor(options, classFactory, baseUrl, loader, nav) {\n        if (!baseUrl) {\n            throw \"Router needs baseUrl to be defined.\";\n        }\n        if (!loader) {\n            throw \"Router needs a GraphicLoader instance to be defined.\";\n        }\n        if (!classFactory) {\n            throw \"Router needs a ClassFactory instance to be defined.\";\n        }\n        if (!nav) {\n            throw \"Router needs a Nav instance to be defined.\";\n        }\n\n        /**\n         * @type {ClassFactory}\n         */\n        this.classFactory = classFactory;\n        /**\n         * @type {String}\n         */\n        this.baseUrl = baseUrl;\n        /**\n         * @type {GraphicLoader}\n         */\n        this.loader = loader;\n        /**\n         * @type {AbstractNav}\n         */\n        this.nav = nav;\n        /**\n         * @type {State|null}\n         */\n        this.state = null;\n        /**\n         * @type {Array}\n         */\n        this.formerPages = [];\n        /**\n         * @type {null}\n         */\n        this.page = null;\n        this.stateBlock = true;\n        this.transition = false;\n        this.loading = false;\n        this.$window = $(window);\n        this.$body = $('body');\n\n        this.deviceType = (isMobile.any === false) ? 'desktop' : 'mobile';\n        Utils.addClass(this.$body[0],'is-'+this.deviceType);\n\n        /**\n         * @deprecated use this.$window instead\n         */\n        this.window = this.$window;\n        this.currentRequest = null;\n        this.cacheProvider = new CacheProvider();\n        /**\n         * @type {Object}\n         */\n        this.options = {\n            homeHasClass: false,\n            ajaxEnabled: true,\n            pageClass: \"page-content\",\n            objectTypeAttr: \"data-node-type\",\n            ajaxLinkTypeAttr: \"data-node-type\",\n            noAjaxLinkClass: \"no-ajax-link\",\n            navLinkClass: \"nav-link\",\n            activeClass: \"active\",\n            pageBlockClass: \".page-block\",\n            lazyloadEnabled: false,\n            lazyloadSrcAttr: 'data-src',\n            lazyloadClass: 'lazyload',\n            lazyloadSrcSetAttr: 'data-src-set',\n            $ajaxContainer: $(\"#ajax-container\"),\n            minLoadDuration: 0,\n            preLoadPageDelay: 0,\n            useCache: true,\n            postLoad: (state, data) => {},\n            preLoad: (state) => {},\n            prePushState: (state) => {},\n            onDestroy: () => {},\n            preBoot: ($cont, context, isHome) => {}\n        };\n\n        if (options !== null) {\n            this.options = $.extend(this.options, options);\n        }\n    }\n\n    destroy() {\n        if (this.options.ajaxEnabled) {\n            window.removeEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        const onDestroyBinded = this.options.onDestroy.bind(this);\n        onDestroyBinded();\n    }\n\n    /**\n     * Initialize Router events.\n     *\n     */\n    initEvents() {\n        if (this.options.ajaxEnabled) {\n            window.addEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        /*\n         * Init nav events\n         */\n        this.nav.initEvents(this);\n    }\n    /**\n     * @private\n     * @param  {Event} event\n     * @return\n     */\n    onPopState(event) {\n        if (typeof event.state !== \"undefined\" && event.state !== null) {\n            this.transition = true;\n            this.loadPage(event, event.state);\n        }\n    }\n\n    /**\n     * Booting need a jQuery handler for the jQuery container.\n     *\n     * Call this method in your `main.js` or app entry point **after** creating\n     * the router and calling `initEvents` method.\n     *\n     * @param  {jQuery}  $cont The jQuery DOM element to boot in.\n     * @param  {String}  context [\"static\" or custom string]\n     * @param  {Boolean} isHome\n     */\n    boot($cont, context, isHome) {\n        if(context == 'static') {\n            this.loadBeginDate = new Date();\n        }\n        const preBootBinded = this.options.preBoot.bind(this);\n        preBootBinded($cont, context, isHome);\n\n        const nodeType = $cont.attr(this.options.objectTypeAttr);\n\n        if(isHome && this.options.homeHasClass){\n            this.page = new Home(this, $cont, context, nodeType, isHome);\n        } else {\n            this.page = this.classFactory.getPageInstance(nodeType, this, $cont, context, nodeType, isHome);\n        }\n\n        if(context == 'ajax') this.state.update(this.page);\n    }\n\n    /**\n     * @private\n     * @param e Event\n     */\n    onLinkClick(e) {\n        const linkClassName = e.currentTarget.className\n        const linkHref = e.currentTarget.href\n\n        if(linkHref.indexOf('mailto:') == -1 &&\n           linkClassName.indexOf(this.options.noAjaxLinkClass) === -1) {\n            e.preventDefault();\n\n            // Check if link is not active\n            if(linkClassName.indexOf(this.options.activeClass) == -1 &&\n                !this.transition) {\n                this.transition = true;\n\n                this.state = new State(this, e.currentTarget, {\n                    previousType: this.page.type,\n                    previousName: this.page.name,\n                    navLinkClass: this.options.navLinkClass,\n                    previousHref: window.location.href\n                });\n\n                const prePushStateBinded = this.options.prePushState.bind(this);\n                prePushStateBinded(this.state);\n\n                if (history.pushState) {\n                    history.pushState(this.state, this.state.title, this.state.href);\n                }\n                this.loadPage(e, this.state);\n            }\n        }\n    }\n\n    /**\n     * Perform a AJAX load for an History event.\n     *\n     * @param e\n     * @param state\n     * @private\n     */\n    loadPage(e, state) {\n        if(this.currentRequest && this.currentRequest.readyState != 4) {\n            this.currentRequest.abort();\n        }\n        this.loader.show();\n        this.loadBeginDate = new Date();\n\n        const preLoadBinded = this.options.preLoad.bind(this);\n        preLoadBinded(state);\n\n        setTimeout(this.doPageLoad.bind(this, state), this.options.preLoadPageDelay);\n    }\n    /**\n     * Actually load the state url resource.\n     *\n     * @param  {State} state\n     */\n    doPageLoad(state) {\n        if (this.options.useCache && this.cacheProvider.exists(state.href)) {\n            log.debug('ðŸ“Ž Use cache-provider for: ' + state.href);\n            this._onDataLoaded(this.cacheProvider.fetch(state.href), state);\n        } else {\n            this.currentRequest = $.ajax({\n                url: state.href,\n                dataType: \"html\",\n                headers: {\n                    // Send header to allow backends to\n                    // send partial response for saving\n                    // bandwidth and process time\n                    'X-Allow-Partial' : 1\n                },\n                // Need to disable cache to prevent\n                // browser to serve partial when no\n                // ajax context is defined.\n                cache: false,\n                type: 'get',\n                success: (data) => {\n                    if (this.options.useCache) {\n                        this.cacheProvider.save(state.href, data);\n                    }\n                    this._onDataLoaded(data, state);\n                }\n            });\n        }\n    }\n\n    /**\n     * @private\n     * @param {Object} data jQuery AJAX response\n     * @param {State} state\n     */\n    _onDataLoaded(data, state) {\n        // Extract only to new page content\n        // if the whole HTML is queried\n        let $data = null;\n        const $response = $($.parseHTML(data.trim()));\n        if ($response.hasClass(this.options.pageClass)) {\n            $data = $response;\n        } else {\n            $data = $response.find('.' + this.options.pageClass);\n        }\n\n        /*\n         * Display data to DOM\n         */\n        this.options.$ajaxContainer.append($data);\n\n        /*\n         * Push a copy object not to set it as null.\n         */\n        this.formerPages.push(this.page);\n\n        // Init new page\n        this.updatePageTitle($data);\n        this.boot($data, 'ajax', state.isHome);\n\n        const postLoadBinded = this.options.postLoad.bind(this);\n        postLoadBinded(state, $data);\n\n        // Analytics\n        if(typeof ga !== \"undefined\") {\n            log.debug('ðŸš© Push Analytics for: ' + window.location.pathname);\n            ga('send', 'pageview', {'page': window.location.pathname, 'title':document.title});\n        }\n    }\n\n    /**\n     * Update page title against data-title attribute\n     * from ajax loaded partial DOM.\n     *\n     * @param {jQuery} $data\n     */\n    updatePageTitle($data){\n        if($data.length && $data.attr('data-meta-title') !== ''){\n            let metaTitle = $data.attr('data-meta-title');\n            if(metaTitle !== null && metaTitle !== '') document.title = metaTitle;\n        }\n    }\n\n    /**\n     * @param {boolean} isHome\n     * @param {string} type\n     * @param {string} name\n     */\n    pushFirstState(isHome, type, name){\n        if (history.pushState) {\n            history.pushState({\n                'firstPage': true,\n                'href':  window.location.href,\n                'isHome':isHome,\n                'nodeType':type,\n                'nodeName':name\n            }, document.title, window.location.href);\n        }\n    }\n}\n"]}