{"version":3,"sources":["router.js"],"names":["Router","options","classFactory","baseUrl","loader","nav","state","formerPages","page","stateBlock","ajaxEnabled","transition","loading","$window","window","$body","deviceType","any","addClass","currentRequest","cacheProvider","homeHasClass","pageClass","objectTypeAttr","ajaxLinkTypeAttr","noAjaxLinkClass","navLinkClass","activeClass","pageBlockClass","lazyloadEnabled","lazyloadSrcAttr","lazyloadClass","lazyloadSrcSetAttr","$ajaxContainer","minLoadDuration","preLoadPageDelay","useCache","postLoad","data","preLoad","prePushState","onDestroy","preBoot","$cont","context","isHome","extend","destroy","removeEventListener","onPopState","bind","onDestroyBinded","initEvents","addEventListener","event","loadPage","boot","loadBeginDate","Date","preBootBinded","nodeType","attr","getPageInstance","update","onLinkClick","e","linkClassName","currentTarget","className","linkHref","href","indexOf","preventDefault","previousType","type","previousName","name","prePushStateBinded","history","pushState","title","readyState","abort","show","preLoadBinded","setTimeout","exists","debug","_onDataLoaded","fetch","ajax","url","dataType","headers","cache","success","save","$data","$response","parseHTML","trim","hasClass","find","append","push","updatePageTitle","postLoadBinded","ga","document","length","metaTitle","pushFirstState","location"],"mappings":"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","file":"router.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file router.js\n * @author Ambroise Maupate\n */\nimport $ from \"jquery\";\nimport isMobile from \"isMobile\";\nimport log from \"loglevel\";\nimport {Utils} from \"utils/utils\";\nimport {State} from \"state\";\nimport {CacheProvider} from \"cache-provider\";\nimport {Home} from \"pages/home\";\n\nexport class Router {\n    /**\n     * Create a new Router.\n     *\n     * Default options list:\n     *\n     * * `homeHasClass`: false,\n     * * `ajaxEnabled`: true,\n     * * `pageClass`: \"page-content\", (Without point!)\n     * * `objectTypeAttr`: \"data-node-type\",\n     * * `ajaxLinkTypeAttr` : \"data-node-type\"\n     * * `noAjaxLinkClass`: \"no-ajax-link\",\n     * * `navLinkClass`: \"nav-link\",\n     * * `activeClass`: \"active\",\n     * * `pageBlockClass`: \".page-block\", (With point!)\n     * * `$ajaxContainer`: $(\"#ajax-container\"),\n     * * `lazyloadEnabled`: false,\n     * * `lazyloadSrcAttr`: 'data-src',\n     * * `lazyloadClass`: 'lazyload',\n     * * `lazyloadSrcSetAttr`: 'data-src-set',\n     * * `minLoadDuration`: 0,\n     * * `postLoad`: (state, data) => {},\n     * * `preLoad`: (state) => {},\n     * * `preLoadPageDelay`: 0\n     * * `prePushState`: (state) => {},\n     * * `onDestroy`: () => {},\n     * * `preBoot`: ($cont, context, isHome) => {},\n     *\n     *\n     * @param {Object} options\n     * @param {ClassFactory} classFactory\n     * @param {String} baseUrl\n     * @param {GraphicLoader} loader\n     * @param {AbstractNav} nav\n     */\n    constructor(options, classFactory, baseUrl, loader, nav) {\n        if (!baseUrl) {\n            throw \"Router needs baseUrl to be defined.\";\n        }\n        if (!loader) {\n            throw \"Router needs a GraphicLoader instance to be defined.\";\n        }\n        if (!classFactory) {\n            throw \"Router needs a ClassFactory instance to be defined.\";\n        }\n        if (!nav) {\n            throw \"Router needs a Nav instance to be defined.\";\n        }\n\n        /**\n         * @type {ClassFactory}\n         */\n        this.classFactory = classFactory;\n        /**\n         * @type {String}\n         */\n        this.baseUrl = baseUrl;\n        /**\n         * @type {GraphicLoader}\n         */\n        this.loader = loader;\n        /**\n         * @type {AbstractNav}\n         */\n        this.nav = nav;\n        /**\n         * @type {State|null}\n         */\n        this.state = null;\n        /**\n         * @type {Array}\n         */\n        this.formerPages = [];\n        /**\n         * @type {null}\n         */\n        this.page = null;\n        this.stateBlock = true;\n        this.ajaxEnabled = true;\n        this.transition = false;\n        this.loading = false;\n        this.$window = $(window);\n        this.$body = $('body');\n\n        this.deviceType = (isMobile.any === false) ? 'desktop' : 'mobile';\n        Utils.addClass(this.$body[0],'is-'+this.deviceType);\n\n        /**\n         * @deprecated use this.$window instead\n         */\n        this.window = this.$window;\n        this.currentRequest = null;\n        this.cacheProvider = new CacheProvider();\n        /**\n         * @type {Object}\n         */\n        this.options = {\n            homeHasClass: false,\n            ajaxEnabled: true,\n            pageClass: \"page-content\",\n            objectTypeAttr: \"data-node-type\",\n            ajaxLinkTypeAttr: \"data-node-type\",\n            noAjaxLinkClass: \"no-ajax-link\",\n            navLinkClass: \"nav-link\",\n            activeClass: \"active\",\n            pageBlockClass: \".page-block\",\n            lazyloadEnabled: false,\n            lazyloadSrcAttr: 'data-src',\n            lazyloadClass: 'lazyload',\n            lazyloadSrcSetAttr: 'data-src-set',\n            $ajaxContainer: $(\"#ajax-container\"),\n            minLoadDuration: 0,\n            preLoadPageDelay: 0,\n            useCache: true,\n            postLoad: (state, data) => {},\n            preLoad: (state) => {},\n            prePushState: (state) => {},\n            onDestroy: () => {},\n            preBoot: ($cont, context, isHome) => {}\n        };\n\n        if (options !== null) {\n            this.options = $.extend(this.options, options);\n        }\n    }\n\n    destroy() {\n        if (this.options.ajaxEnabled) {\n            window.removeEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        const onDestroyBinded = this.options.onDestroy.bind(this);\n        onDestroyBinded();\n    }\n\n    /**\n     * Initialize Router events.\n     *\n     */\n    initEvents() {\n        if (this.options.ajaxEnabled) {\n            window.addEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        /*\n         * Init nav events\n         */\n        this.nav.initEvents(this);\n    }\n    /**\n     * @private\n     * @param  {Event} event\n     * @return\n     */\n    onPopState(event) {\n        if (typeof event.state !== \"undefined\" && event.state !== null) {\n            this.transition = true;\n            this.loadPage(event, event.state);\n        }\n    }\n\n    /**\n     * Booting need a jQuery handler for the jQuery container.\n     *\n     * Call this method in your `main.js` or app entry point **after** creating\n     * the router and calling `initEvents` method.\n     *\n     * @param  {jQuery}  $cont The jQuery DOM element to boot in.\n     * @param  {String}  context [\"static\" or custom string]\n     * @param  {Boolean} isHome\n     */\n    boot($cont, context, isHome) {\n        if(context == 'static') {\n            this.loadBeginDate = new Date();\n        }\n        const preBootBinded = this.options.preBoot.bind(this);\n        preBootBinded($cont, context, isHome);\n\n        const nodeType = $cont.attr(this.options.objectTypeAttr);\n\n        if(isHome && this.options.homeHasClass){\n            this.page = new Home(this, $cont, context, nodeType, isHome);\n        } else {\n            this.page = this.classFactory.getPageInstance(nodeType, this, $cont, context, nodeType, isHome);\n        }\n\n        if(context == 'ajax') this.state.update(this.page);\n    }\n\n    /**\n     * @private\n     * @param e Event\n     */\n    onLinkClick(e) {\n        const linkClassName = e.currentTarget.className,\n            linkHref = e.currentTarget.href;\n\n        if(linkHref.indexOf('mailto:') == -1) {\n            e.preventDefault();\n\n            // Check if link is not active\n            if(linkClassName.indexOf(this.options.activeClass) == -1 &&\n               linkClassName.indexOf(this.options.noAjaxLinkClass) == -1 &&\n               !this.transition) {\n                this.transition = true;\n\n                this.state = new State(this, e.currentTarget, {\n                    previousType: this.page.type,\n                    previousName: this.page.name,\n                    navLinkClass: this.options.navLinkClass\n                });\n\n                const prePushStateBinded = this.options.prePushState.bind(this);\n                prePushStateBinded(this.state);\n\n                if (history.pushState) {\n                    history.pushState(this.state, this.state.title, this.state.href);\n                }\n                this.loadPage(e, this.state);\n            }\n        }\n    }\n\n    /**\n     * Perform a AJAX load for an History event.\n     *\n     * @param e\n     * @param state\n     * @private\n     */\n    loadPage(e, state) {\n        if(this.currentRequest && this.currentRequest.readyState != 4) {\n            this.currentRequest.abort();\n        }\n        this.loader.show();\n        this.loadBeginDate = new Date();\n\n        const preLoadBinded = this.options.preLoad.bind(this);\n        preLoadBinded(state);\n\n        setTimeout(() => {\n            if (this.options.useCache && this.cacheProvider.exists(state.href)) {\n                log.debug('ðŸ“Ž Use cache-provider for: ' + state.href);\n                this._onDataLoaded(this.cacheProvider.fetch(state.href), state);\n            } else {\n                this.currentRequest = $.ajax({\n                    url: state.href,\n                    dataType: \"html\",\n                    headers: {\n                        // Send header to allow backends to\n                        // send partial response for saving\n                        // bandwidth and process time\n                        'X-Allow-Partial' : 1\n                    },\n                    // Need to disable cache to prevent\n                    // browser to serve partial when no\n                    // ajax context is defined.\n                    cache: false,\n                    type: 'get',\n                    success: (data) => {\n                        if (this.options.useCache) {\n                            this.cacheProvider.save(state.href, data);\n                        }\n                        this._onDataLoaded(data, state);\n                    }\n                });\n            }\n\n        }, this.options.preLoadPageDelay);\n    }\n\n    /**\n     * @private\n     * @param {Object} data jQuery AJAX response\n     */\n    _onDataLoaded(data, state) {\n         // Extract only to new page content\n        // if the whole HTML is queried\n\n        let $data = null;\n        const $response = $($.parseHTML(data.trim()));\n        if ($response.hasClass(this.options.pageClass)) {\n            $data = $response;\n        } else {\n            $data = $response.find('.' + this.options.pageClass);\n        }\n\n        /*\n         * Display data to DOM\n         */\n        this.options.$ajaxContainer.append($data);\n\n        /*\n         * Push a copy object not to set it as null.\n         */\n        this.formerPages.push(this.page);\n\n        // Init new page\n        this.updatePageTitle($data);\n        this.boot($data, 'ajax', state.isHome);\n\n        const postLoadBinded = this.options.postLoad.bind(this);\n        postLoadBinded(state, $data);\n\n        // Analytics\n        if(typeof ga !== \"undefined\") {\n            ga('send', 'pageview', {'page':state.href, 'title':document.title});\n        }\n    }\n\n    /**\n     * Update page title against data-title attribute\n     * from ajax loaded partial DOM.\n     *\n     * @param {jQuery} $data\n     */\n    updatePageTitle($data){\n        if($data.length && $data.attr('data-meta-title') !== ''){\n            let metaTitle = $data.attr('data-meta-title');\n            if(metaTitle !== null && metaTitle !== '') document.title = metaTitle;\n        }\n    }\n\n    /**\n     *\n     * @param {boolean} isHome\n     */\n    pushFirstState(isHome){\n        if (history.pushState) {\n            history.pushState({\n                'firstPage': true,\n                'href':  window.location.href,\n                'isHome':isHome\n            }, null, window.location.href);\n        }\n    }\n}\n"]}