{"version":3,"sources":["router.js"],"names":["Router","options","classFactory","baseUrl","loader","nav","state","formerPages","page","stateBlock","transition","loading","$window","window","$body","deviceType","isMobile","any","Utils","addClass","currentRequest","cacheProvider","CacheProvider","homeHasClass","ajaxEnabled","pageClass","objectTypeAttr","ajaxLinkTypeAttr","noAjaxLinkClass","navLinkClass","activeClass","pageBlockClass","lazyloadEnabled","lazyloadSrcAttr","lazyloadClass","lazyloadSrcSetAttr","$ajaxContainer","minLoadDuration","preLoadPageDelay","useCache","postLoad","data","preLoad","prePushState","onDestroy","preBoot","$cont","context","isHome","$","extend","destroy","removeEventListener","onPopState","bind","onDestroyBinded","initEvents","addEventListener","event","loadPage","boot","loadBeginDate","Date","preBootBinded","nodeType","attr","Home","getPageInstance","update","onLinkClick","e","linkClassName","currentTarget","className","linkHref","href","indexOf","preventDefault","State","previousType","type","previousName","name","previousHref","location","prePushStateBinded","history","pushState","title","readyState","abort","show","preLoadBinded","setTimeout","doPageLoad","exists","log","debug","_onDataLoaded","fetch","ajax","url","dataType","headers","cache","success","save","$data","$response","parseHTML","trim","hasClass","find","append","push","updatePageTitle","postLoadBinded","ga","pathname","document","length","metaTitle","pushFirstState"],"mappings":"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","file":"router.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file router.js\n * @author Ambroise Maupate\n */\nimport $ from \"jquery\";\nimport isMobile from \"isMobile\";\nimport log from \"loglevel\";\nimport {Utils} from \"utils/utils\";\nimport {State} from \"state\";\nimport {CacheProvider} from \"cache-provider\";\nimport {Home} from \"pages/home\";\n\nexport class Router {\n    /**\n     * Create a new Router.\n     *\n     * Default options list:\n     *\n     * * `homeHasClass`: false,\n     * * `ajaxEnabled`: true,\n     * * `pageClass`: \"page-content\", (Without point!)\n     * * `objectTypeAttr`: \"data-node-type\",\n     * * `ajaxLinkTypeAttr` : \"data-node-type\"\n     * * `noAjaxLinkClass`: \"no-ajax-link\",\n     * * `navLinkClass`: \"nav-link\",\n     * * `activeClass`: \"active\",\n     * * `useCache`: true,\n     * * `pageBlockClass`: \".page-block\", (With point!)\n     * * `$ajaxContainer`: $(\"#ajax-container\"),\n     * * `lazyloadEnabled`: false,\n     * * `lazyloadSrcAttr`: 'data-src',\n     * * `lazyloadClass`: 'lazyload',\n     * * `lazyloadSrcSetAttr`: 'data-src-set',\n     * * `minLoadDuration`: 0,\n     * * `postLoad`: (state, data) => {},\n     * * `preLoad`: (state) => {},\n     * * `preLoadPageDelay`: 0\n     * * `prePushState`: (state) => {},\n     * * `onDestroy`: () => {},\n     * * `preBoot`: ($cont, context, isHome) => {},\n     *\n     *\n     * @param {Object} options\n     * @param {ClassFactory} classFactory\n     * @param {String} baseUrl\n     * @param {GraphicLoader} loader\n     * @param {AbstractNav} nav\n     */\n    constructor(options, classFactory, baseUrl, loader, nav) {\n        if (!baseUrl) {\n            throw \"Router needs baseUrl to be defined.\";\n        }\n        if (!loader) {\n            throw \"Router needs a GraphicLoader instance to be defined.\";\n        }\n        if (!classFactory) {\n            throw \"Router needs a ClassFactory instance to be defined.\";\n        }\n        if (!nav) {\n            throw \"Router needs a Nav instance to be defined.\";\n        }\n\n        /**\n         * @type {ClassFactory}\n         */\n        this.classFactory = classFactory;\n        /**\n         * @type {String}\n         */\n        this.baseUrl = baseUrl;\n        /**\n         * @type {GraphicLoader}\n         */\n        this.loader = loader;\n        /**\n         * @type {AbstractNav}\n         */\n        this.nav = nav;\n        /**\n         * @type {State|null}\n         */\n        this.state = null;\n        /**\n         * @type {Array}\n         */\n        this.formerPages = [];\n        /**\n         * @type {null}\n         */\n        this.page = null;\n        this.stateBlock = true;\n        this.transition = false;\n        this.loading = false;\n        this.$window = $(window);\n        this.$body = $('body');\n\n        this.deviceType = (isMobile.any === false) ? 'desktop' : 'mobile';\n        Utils.addClass(this.$body[0],'is-'+this.deviceType);\n\n        /**\n         * @deprecated use this.$window instead\n         */\n        this.window = this.$window;\n        this.currentRequest = null;\n        this.cacheProvider = new CacheProvider();\n        /**\n         * @type {Object}\n         */\n        this.options = {\n            homeHasClass: false,\n            ajaxEnabled: true,\n            pageClass: \"page-content\",\n            objectTypeAttr: \"data-node-type\",\n            ajaxLinkTypeAttr: \"data-node-type\",\n            noAjaxLinkClass: \"no-ajax-link\",\n            navLinkClass: \"nav-link\",\n            activeClass: \"active\",\n            pageBlockClass: \".page-block\",\n            lazyloadEnabled: false,\n            lazyloadSrcAttr: 'data-src',\n            lazyloadClass: 'lazyload',\n            lazyloadSrcSetAttr: 'data-src-set',\n            $ajaxContainer: $(\"#ajax-container\"),\n            minLoadDuration: 0,\n            preLoadPageDelay: 0,\n            useCache: true,\n            postLoad: (state, data) => {},\n            preLoad: (state) => {},\n            prePushState: (state) => {},\n            onDestroy: () => {},\n            preBoot: ($cont, context, isHome) => {}\n        };\n\n        if (options !== null) {\n            this.options = $.extend(this.options, options);\n        }\n    }\n\n    destroy() {\n        if (this.options.ajaxEnabled) {\n            window.removeEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        const onDestroyBinded = this.options.onDestroy.bind(this);\n        onDestroyBinded();\n    }\n\n    /**\n     * Initialize Router events.\n     *\n     */\n    initEvents() {\n        if (this.options.ajaxEnabled) {\n            window.addEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        /*\n         * Init nav events\n         */\n        this.nav.initEvents(this);\n    }\n    /**\n     * @private\n     * @param  {Event} event\n     * @return\n     */\n    onPopState(event) {\n        if (typeof event.state !== \"undefined\" && event.state !== null) {\n            this.transition = true;\n            this.loadPage(event, event.state);\n        }\n    }\n\n    /**\n     * Booting need a jQuery handler for the jQuery container.\n     *\n     * Call this method in your `main.js` or app entry point **after** creating\n     * the router and calling `initEvents` method.\n     *\n     * @param  {jQuery}  $cont The jQuery DOM element to boot in.\n     * @param  {String}  context [\"static\" or custom string]\n     * @param  {Boolean} isHome\n     */\n    boot($cont, context, isHome) {\n        if(context == 'static') {\n            this.loadBeginDate = new Date();\n        }\n        const preBootBinded = this.options.preBoot.bind(this);\n        preBootBinded($cont, context, isHome);\n\n        const nodeType = $cont.attr(this.options.objectTypeAttr);\n\n        if(isHome && this.options.homeHasClass){\n            this.page = new Home(this, $cont, context, nodeType, isHome);\n        } else {\n            this.page = this.classFactory.getPageInstance(nodeType, this, $cont, context, nodeType, isHome);\n        }\n\n        if(context == 'ajax') this.state.update(this.page);\n    }\n\n    /**\n     * @private\n     * @param e Event\n     */\n    onLinkClick(e) {\n        const linkClassName = e.currentTarget.className\n        const linkHref = e.currentTarget.href\n\n        if(linkHref.indexOf('mailto:') == -1 &&\n           linkClassName.indexOf(this.options.noAjaxLinkClass) === -1) {\n            e.preventDefault();\n\n            // Check if link is not active\n            if(linkClassName.indexOf(this.options.activeClass) == -1 &&\n                !this.transition) {\n                this.transition = true;\n\n                this.state = new State(this, e.currentTarget, {\n                    previousType: this.page.type,\n                    previousName: this.page.name,\n                    navLinkClass: this.options.navLinkClass,\n                    previousHref: window.location.href\n                });\n\n                const prePushStateBinded = this.options.prePushState.bind(this);\n                prePushStateBinded(this.state);\n\n                if (history.pushState) {\n                    history.pushState(this.state, this.state.title, this.state.href);\n                }\n                this.loadPage(e, this.state);\n            }\n        }\n    }\n\n    /**\n     * Perform a AJAX load for an History event.\n     *\n     * @param e\n     * @param state\n     * @private\n     */\n    loadPage(e, state) {\n        if(this.currentRequest && this.currentRequest.readyState != 4) {\n            this.currentRequest.abort();\n        }\n        this.loader.show();\n        this.loadBeginDate = new Date();\n\n        const preLoadBinded = this.options.preLoad.bind(this);\n        preLoadBinded(state);\n\n        setTimeout(this.doPageLoad.bind(this, state), this.options.preLoadPageDelay);\n    }\n    /**\n     * Actually load the state url resource.\n     *\n     * @param  {State} state\n     */\n    doPageLoad(state) {\n        if (this.options.useCache && this.cacheProvider.exists(state.href)) {\n            log.debug('ðŸ“Ž Use cache-provider for: ' + state.href);\n            this._onDataLoaded(this.cacheProvider.fetch(state.href), state);\n        } else {\n            this.currentRequest = $.ajax({\n                url: state.href,\n                dataType: \"html\",\n                headers: {\n                    // Send header to allow backends to\n                    // send partial response for saving\n                    // bandwidth and process time\n                    'X-Allow-Partial' : 1\n                },\n                // Need to disable cache to prevent\n                // browser to serve partial when no\n                // ajax context is defined.\n                cache: false,\n                type: 'get',\n                success: (data) => {\n                    if (this.options.useCache) {\n                        this.cacheProvider.save(state.href, data);\n                    }\n                    this._onDataLoaded(data, state);\n                }\n            });\n        }\n    }\n\n    /**\n     * @private\n     * @param {Object} data jQuery AJAX response\n     * @param {State} state\n     */\n    _onDataLoaded(data, state) {\n        // Extract only to new page content\n        // if the whole HTML is queried\n        let $data = null;\n        const $response = $($.parseHTML(data.trim()));\n        if ($response.hasClass(this.options.pageClass)) {\n            $data = $response;\n        } else {\n            $data = $response.find('.' + this.options.pageClass);\n        }\n\n        /*\n         * Display data to DOM\n         */\n        this.options.$ajaxContainer.append($data);\n\n        /*\n         * Push a copy object not to set it as null.\n         */\n        this.formerPages.push(this.page);\n\n        // Init new page\n        this.updatePageTitle($data);\n        this.boot($data, 'ajax', state.isHome);\n\n        const postLoadBinded = this.options.postLoad.bind(this);\n        postLoadBinded(state, $data);\n\n        // Analytics\n        if(typeof ga !== \"undefined\") {\n            log.debug('ðŸš© Push Analytics for: ' + window.location.pathname);\n            ga('send', 'pageview', {'page': window.location.pathname, 'title':document.title});\n        }\n    }\n\n    /**\n     * Update page title against data-title attribute\n     * from ajax loaded partial DOM.\n     *\n     * @param {jQuery} $data\n     */\n    updatePageTitle($data){\n        if($data.length && $data.attr('data-meta-title') !== ''){\n            let metaTitle = $data.attr('data-meta-title');\n            if(metaTitle !== null && metaTitle !== '') document.title = metaTitle;\n        }\n    }\n\n    /**\n     * @param {boolean} isHome\n     * @param {string} type\n     * @param {string} name\n     */\n    pushFirstState(isHome, type, name){\n        if (history.pushState) {\n            history.pushState({\n                'firstPage': true,\n                'href':  window.location.href,\n                'isHome':isHome,\n                'nodeType':type,\n                'nodeName':name\n            }, document.title, window.location.href);\n        }\n    }\n}\n"]}